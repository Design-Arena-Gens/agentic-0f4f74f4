import { useEffect, useMemo, useState } from "react";

const RU = {
  title: "Quizzes AI ? ??? ????",
  subtitle: "?????? ? ?? ???? ?? ???????",
  cta: "????????????? ?????? ?????????",
  generatedTitle: "?????? ????????? (AI)",
  whatIs: "Quizzes AI ? ??? ?????????? ?? ?????? ?????????????? ??????????, ??????? ???????? ?????? ????????? ????????????? ?????????, ????? ? ??????. ?? ??????????? ???? ? ????????????? ?????????? ???????, ???????? ??????? ? ?????????.",
  featuresTitle: "??? ?????:",
  features: [
    "????????? ???????? ?? ???? ?? ???????",
    "????????? ? ????????? ? ???????",
    "??????? ? ??????????? ?? ?????/?????",
    "???????????: ???????? ?? ??????? ? ??????????"
  ],
  useCasesTitle: "???? ??? ???????:",
  useCases: [
    "???????? ? ??? ??????? ??????????? ?????",
    "????????? ? ??? ??????????????",
    "HR ? ???????? ? ??? ?????????? ? ??????",
    "?????????? ? ??? ??????????? ??????"
  ],
  faqTitle: "FAQ",
  faq: [
    {
      q: "??? ????????? ????????",
      a: "??? ????? ???????? ?????? ????????????. ?????????? ?????? ???????, ??????? ?????????? ?? ??? ???????? ??????."
    },
    {
      q: "????? ?? ?????? ???????",
      a: "???. ?????????? ???????? ???? ? ???????? ??????? ????????? ? ?? ????????? ?????????."
    },
    {
      q: "??? ??????????",
      a: "??????? ?? ???????. ?????? ???? ?????????? ????? ? ??????? ??????????? ???????."
    }
  ],
  langLabel: "????",
  ru: "???????",
  ua: "??????????"
};

const UA = {
  title: "Quizzes AI ? ?? ???",
  subtitle: "??????? ? ?? ???? ???????????",
  cta: "??????????? ??????? ?????????",
  generatedTitle: "??????? ????????? (AI)",
  whatIs: "Quizzes AI ? ?? ?????????? ?? ?????? ???????? ?????????, ???? ????????? ?????? ?????????? ???????????? ?????????, ????? ?? ??????????. ??? ???????? ???? ? ??????????? ???????? ?????????, ???????? ?????????? ?? ?????????.",
  featuresTitle: "?? ????:",
  features: [
    "????????? ???????? ?? ????? ?? ???????",
    "???????? ?? ????????? ?? ??????????",
    "??????? ? ???????????? ?? ?????/?????",
    "???????????: ?????? ?????????? ?? ???????????"
  ],
  useCasesTitle: "???? ???????:",
  useCases: [
    "???????? ? ??? ??????? ???????????? ?????",
    "????????? ? ??? ??????????????",
    "HR ?? ???????? ? ??? ?????????? ? ??????",
    "?????????? ? ??? ?????????? ??????"
  ],
  faqTitle: "FAQ",
  faq: [
    {
      q: "?? ??????? ????????",
      a: "?? ??????????? ????? ????? ????????????. ??????? ????? ??????? ? ?? ??? ????????? ??????."
    },
    {
      q: "???????? ???????? ????????",
      a: "??. ????????? ??????? ???? ? ?????? ?????????? ? ?? ?????????? ?????????."
    },
    {
      q: "?? ????????????",
      a: "???????? ??? ???????. ???????? ? ???????????? ????? ? ?????? ???????."
    }
  ],
  langLabel: "????",
  ru: "???????",
  ua: "??????????"
};

const baseQuestions = [
  {
    id: 1,
    t: {
      ru: "??? ????? ???",
      ua: "?? ???? ???"
    },
    options: {
      ru: [
        "?????????????? ???????",
        "???????, ??????????? ???????????????? ???????",
        "?????? ?????"
      ],
      ua: [
        "??????????? ???????",
        "???????, ?? ?????? ?????????????? ???????",
        "???? ?????"
      ]
    },
    answerIndex: 1
  },
  {
    id: 2,
    t: {
      ru: "??? ???? ?????????? ??????",
      ua: "??? ???? ?????????????? ??????"
    },
    options: {
      ru: ["???????", "???????? ?? ?????????", "?????? ????????"],
      ua: ["???????", "???????? ?? ?????????", "?????? ????????"]
    },
    answerIndex: 2
  }
];

export default function Home() {
  const [lang, setLang] = useState("auto");
  const resolvedLang = useMemo(() => {
    if (lang === "auto") {
      if (typeof navigator !== "undefined") {
        const n = navigator.language?.toLowerCase() || "ru";
        return n.startsWith("uk") || n.startsWith("ukr") || n.startsWith("ua") ? "ua" : "ru";
      }
      return "ru";
    }
    return lang;
  }, [lang]);

  const t = resolvedLang === "ua" ? UA : RU;

  const [quiz, setQuiz] = useState(null);
  const [selected, setSelected] = useState({});
  const [score, setScore] = useState(null);

  const generate = () => {
    const localized = baseQuestions.map((q) => ({
      id: q.id,
      text: q.t[resolvedLang],
      options: q.options[resolvedLang],
      answerIndex: q.answerIndex
    }));
    setQuiz(localized);
    setSelected({});
    setScore(null);
  };

  const submit = () => {
    if (!quiz) return;
    let s = 0;
    quiz.forEach((q, idx) => {
      if (selected[idx] === q.answerIndex) s += 1;
    });
    setScore(`${s} / ${quiz.length}`);
  };

  useEffect(() => {
    // pre-generate on first load for a quick demo
    generate();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [resolvedLang]);

  return (
    <main className="container">
      <header className="header">
        <div className="brand">Quizzes AI</div>
        <div className="lang">
          <label>
            {t.langLabel}
            <select value={lang} onChange={(e) => setLang(e.target.value)}>
              <option value="auto">Auto</option>
              <option value="ru">{t.ru}</option>
              <option value="ua">{t.ua}</option>
            </select>
          </label>
        </div>
      </header>

      <section className="hero">
        <h1>{t.title}</h1>
        <p className="subtitle">{t.subtitle}</p>
        <p className="lead">{t.whatIs}</p>
      </section>

      <section className="grid">
        <div className="card">
          <h3>{t.featuresTitle}</h3>
          <ul>
            {t.features.map((f, i) => (
              <li key={i}>{f}</li>
            ))}
          </ul>
        </div>
        <div className="card">
          <h3>{t.useCasesTitle}</h3>
          <ul>
            {t.useCases.map((f, i) => (
              <li key={i}>{f}</li>
            ))}
          </ul>
        </div>
      </section>

      <section className="quiz">
        <div className="quiz-header">
          <h2>{t.generatedTitle}</h2>
          <button className="primary" onClick={generate}>{t.cta}</button>
        </div>
        {quiz && (
          <div className="quiz-body">
            {quiz.map((q, idx) => (
              <div key={q.id} className="q">
                <div className="qt">{idx + 1}. {q.text}</div>
                <div className="opts">
                  {q.options.map((opt, oi) => (
                    <label key={oi} className={`opt ${selected[idx] === oi ? 'selected' : ''}`}>
                      <input
                        type="radio"
                        name={`q_${idx}`}
                        checked={selected[idx] === oi}
                        onChange={() => setSelected({ ...selected, [idx]: oi })}
                      />
                      <span>{opt}</span>
                    </label>
                  ))}
                </div>
              </div>
            ))}
            <button className="secondary" onClick={submit}>OK</button>
            {score && <div className="score">Score: {score}</div>}
          </div>
        )}
      </section>

      <section className="faq">
        <h3>{t.faqTitle}</h3>
        {t.faq.map((item, i) => (
          <details key={i}>
            <summary>{item.q}</summary>
            <p>{item.a}</p>
          </details>
        ))}
      </section>

      <footer className="footer">? {new Date().getFullYear()} Quizzes AI</footer>
    </main>
  );
}
